## SQL 활용

### 프로시저

1. 프로시저의 개요
   - 프로시저란 절차형 SQL을 활용하여 특정 기능을 수행하는 일종의 트랜잭션 언어로, 호출을 통해 실행되어 미리 저장해 놓은 SQL 작업을 수행한다.
   ```{.sql}
   DECLARE
   BEGIN
       CONTROL
       SQL
       EXCEPTION
       TRANSACTION
   END
   ```
2. 프리시정 생성
   ```{.sql}
   CREATE PROCEDURE
   BEGIN
   END
   ```
   ```{.sql}
   CREATE OR REPLACE PROCEDURE emp_change_s(i_사원번호 IN INT)
   IS
   BEGIN
       UPDATE 급여 SET 지급방식 = "S" WHERE 사원번호 = i_사원번호;
       EXCEPTION
           WHEM PROGRAM_ERROR THEN
               ROLLBACK
       COMMIT
   END;
   ```
3. 프로시저 실행
   - 프로시저를 실행하기 위해서는 EXECUTE 명령어 또는 CALL 명령어를 사용하며, EXECUTE 명령어를 줄여서 EXEC로 사용하기도 한다.
   ```{.sql}
   EXECUTE emp_change_s(32);
   ```
4. 프로시저 제거
   ```{.sql}
   DROP PROCEDURE enp_chage_s(32);
   ```

### 트리거 (Trigger)

1. 트리거의 개요
   - 트리거는 데이터베이스 시스템에서 데이터의 삽입, 갱신, 삭제 등의 이벤트가 발생할 때마나 관련 작업이 자동으로 수행되는 절차형 SQL이다.
2. 트리거의 구성
   ```{.sql}
   DECLARE
   EVENT
   BEGIN
       CONTROL
       SQL
       EXCEPTION
   END
   ```
3. 트리거의 생성
   ```{.sql}
   CREATE TRIGGER 학년정보_tri BEFORE INTSERT ON 학생
   REFERENCING NEW AS new_table
   FOR EACH ROW
   WHEN (new_table.학년 IS NULL)
       BEGIN
           :new_table 핛년:= "신입생"
       END;
   ```
4. 트리거의 제거
   - DROP TRIGGER

### 사용자 정의 함수

1. 사용자 정의 함수의 개요
   - 프로시저와 같은 일련의 작업을 수행, 종료 시 처리 결과를 단일값으로 반환
   - 조회만 가능
2. 사용자 정의 함수의 구성
   ```{.sql}
   DECLARE
   BEGIN
       CONTROL
       SQL
       EXCEPTION
       RETURN
   END
   ```
3. 사용자 정의 함수 생성
   - CREATE FUNCTION
4. 사용자 정의 함수 실행
   - 사용자 정의 함수는 DML에서 속석명이나 값이 놓일 자리를 대체하여 사용
5. 사용자 정의 함수 제거
   - DROP FUNCTION

### DBMS 접속 기술

1. DBMS 접속의 개요
   - DBMS 접속은 사용자가 데이터를 사용하기 위해 응용 시스템을 이용하여 DBMS에 접근하는 것을 의미한다.
2. DBMS 접속 기술
   - DBMS 접속 기술은 DBMS에 접근하기 위해 사용하는 API 또는 API의 사용을 편리하게 도와주는 프레임워크 등을 의미한다.
   - JDBC (JAVA DATEBASE COnnectivity)
     - JDBC는 java 언어로 다양한 종류의 데이터베이스에 접속하고 SQL문을 수행할 때 사용되는 표준 API이다.
   - ODBC
     - ODBC는 데이터베이스 접근하기 위한 표준 개발형 API로, 개발 언어에 관계없이 사용할 수 있다.
3. 동적 SQL
   - 동적 SQL은 개발 언어에 삽입되는 SQL 코드를 문자열 변수에 넣어 처리하는 것으로, 조건에 따라 SQL 구문을 동적으로 변경하여 처리할 수 있다.

### SQL 테스트

1. SQL 테스트의 개요
   - SQL 테스트는 SQL이 작성 의도에 맞게 원하는 기능을 수행하는지 검증하는 과정이다.
2. 단문 SQL 테스트
   - 단문 SQL 테스트는 DDL, DML, DCL이 포함되어 있는 SQL과 TCL을 테스트하는 것으로, 직접 실행하여 결과물을 확인한다.
3. 절차형 SQL 테스트
   - 프로시저, 사용자 정의 함수, 트리거 등의 절차형 SQL은 디버깅을 통해 기능의 적합성 여부를 검증하고, 실행을 통해 결과를 확인하는 테스트를 수행한다.

### ORM(Object - Relational - Mapping)

1. ORM의 개요
   - ORM은 객체지향 프로그래밍의 객체와 관계형 데이터베이스의 데이터를 연결하는 기술이다.
     - ORM은 객체지향 프로그래밍에서 사용할 수 있는 가상의 객체지향 데이터베이스를 만들어 프로그래밍 코드와 데이터를 연결한다.
     - ORM으로 생성된 가상의 객체지향 데이터베이스는 프로그래밍 코드 또는 데이터베이스와 득립적이므로 재상용 및 유지보수가 용이하다.
     - ORM은 SQL 코드를 직접 입력하지 않고 선언문이나 할당 같은 부수적인 코드가 생량되기 때문에 직관적이고 간단하게 데이터를 조회 할 수 있다.
2. ORM 프레임워크
   - JAVA : JPA, Hibernate 등
   - Python : Django, SQLAlchemy
3. ORM의 한계
   - ORM은 프레임워크가 자동으로 SQL을 작성하기 때문에 의도대로 SQL이 작성되었는지 확인할 필요가 있다.
   - 객체지향적인 사용을 고려해야 하고, 설계된 데이터베이스가 아닌 경우 프로젝트가 크고 복잡해질수록 ORM 기술을 적용하기 어려워진다.
   - 기존의 기업들은 ORM을 고려하지 않은 데이터베이스를 사용하고 있기 때문에 ORM에 적합하게 변환하려면 많은 시간과 노력이 필요하다.

### 쿼리 성능 최적화

1. 쿼리 성능 최적화의 개요
   - 쿼리 성능 최적화는 데이터 입,출력 어플리케이션의 성능 향상을 위해 SQL 코드를 최적화하는 것이다.
     - 쿼리 성능을 최적화하기 전에 성능 측정 도구인 APM을 사용하여 최적화 할 쿼리를 선정해야 한다.
     - 최적화 할 쿼리에 대해 옵티마이저가 수립한 실행 계획을 검토하고 SQL 코드와 인덱스를 재구성한다.
2. 실행 계획
   - 실행 계획은 DBMS의 옵티마이저가 수립한 SQL 코드의 실행 절차와 방법을 의미한다.
3. 쿼리 성능 최적화
   - 퀴리 성능 최적화는 실행 계획에 표시된 연산 순서, 조인 방식, 테이블 조회 방법 등을 참고하여 SQL문이 더 빠르고 효율적으로 작동하도록 SQL 코드와 인덱스를 재구성하는 것을 의미한다.
   - SQL 코드 재구성
     - WHERE 절을 추가하여 일부 레코드만 조회하게 함으로써 조회에 들어가는 비용을 줄인다.
     - WHERE 절에 연산자가 포함되면 INDEX를 활용하지 못하므로 가능한 한 연산자 사용을 자제한다.
     - 서브 쿼리에 특정 데이터가 존재하는지 확인할 때는 IN 보타 EXists를 활용한다.
     - 옵티마이저의 실행 게획이 잘못되었다고 판단되는 경우 힌트를 활용하여 실행계획의 엑세스 경로 및 조인 순서를 변경한다.
   - 인덱스 재구성
     - SQL 코드에서 조회되는 속성과 조건들을 고려하여 인덱스를 구성한다.
     - 실행 계획을 참고하여 인덱스를 추가하거나 기존 인덱스의 열 순서를 변경한다.
     - 인덱스의 추가 및 변경은 해당 테이블을 참조하는 다른 SQL문에도 영향을 줄 수 있으므로 신중히 결정한다.
     - 단일 인덱스로 쓰기나 수정 없이 읽기로만 사용되는 테이블의 경우 IOT로 구성하는 것을 고려한다.
